YUI.add("moodle-atto_inokufu-button",function(a,t){const n="atto_inokufu",o={URL:"urlentry",TITLE:"titleentry"},l={RESOURCEURLWARNING:n+"_urlwarning",RESOURCETITLEWARNING:n+"_titlewarning",INPUTURL:n+"_"+o.URL,INPUTTITLE:n+"_"+o.TITLE,INPUTTITLELABEL:n+`_${o.TITLE}_label`,INPUTTITLECOUNTERDIV:n+`_${o.TITLE}_counter_div`,INPUTTITLECOUNTER:n+`_${o.TITLE}_counter`,INPUTTITLECOUNTERWARNING:n+`_${o.TITLE}_counterwarning`,FILEPICKER:n+"_filepicker",SUBMIT:n+"_submitbutton",SUBMITDIV:n+"_submitdiv"},T={INPUTURL:"."+l.INPUTURL,INPUTTITLE:"."+l.INPUTTITLE,FILEPICKER:"."+l.FILEPICKER,SUBMIT:"."+l.SUBMIT},i=[T.INPUTTITLE,"."+l.INPUTTITLELABEL,"."+l.INPUTTITLECOUNTERDIV,"."+l.SUBMITDIV];a.namespace("M."+n).Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_currentObject:null,initializer:function(){this.get("disabled")||this.addButton({icon:"ed/icon",iconComponent:n,buttonName:"InokufuSearch",callback:this._displayDialogue})},_displayDialogue:function(){const t=this.getDialogue({headerContent:M.util.get_string("loproperties",n),width:"auto",focusAfterHide:!0,focusOnShowSelector:T.INPUTURL});t.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){const t=a.Handlebars.compile('<form class="atto_form"><div style="display:none" role="alert" class="alert alert-warning mb-1 {{CSS.RESOURCEURLWARNING}}"><label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "resourceurlrequired" component}}</label></div><div style="display:none" role="alert" class="alert alert-warning mb-1 {{CSS.RESOURCETITLEWARNING}}"><label for="{{elementid}}_{{CSS.INPUTTITLE}}">{{get_string "resourcetitlerequired" component}}</label></div>{{#if showFilepicker}}<div class="mb-1"><div class="input-group w-100"><input name="{{FORMNAMES.URL}}" class="form-control {{CSS.INPUTURL}}" type="hidden" id="{{elementid}}_{{CSS.INPUTURL}}" /></div><button class="btn btn-secondary {{CSS.FILEPICKER}} w-100" type="button">{{get_string "browserepositories" component}}</button></div>{{else}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTURL}}" class="{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label><input name="{{FORMNAMES.URL}}" class="form-control fullwidth {{CSS.INPUTURL}}" type="url" id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/></div>{{/if}}<div class="mb-1"><label for="{{elementid}}_{{CSS.INPUTTITLE}}" class="{{CSS.INPUTTITLELABEL}}">{{get_string "entertitle" component}}</label><input name="{{FORMNAMES.TITLE}}" class="form-control fullwidth {{CSS.INPUTTITLE}}" type="text" id="{{elementid}}_{{CSS.INPUTTITLE}}" size="32" placeholder="{{get_string "entertitleplaceholder" component}}"/></div><div class="{{CSS.INPUTTITLECOUNTERDIV}}"><div class="d-flex justify-content-end small"><span class="{{CSS.INPUTTITLECOUNTER}}">0</span><span>/</span><span>{{titleMaxLength}}</span></div><div class="{{CSS.INPUTTITLECOUNTERWARNING}}" style="display:none; color: red;">{{get_string "errortitletoolong" component}}</div></div><div class="mdl-align {{CSS.SUBMITDIV}}"><br/><button type="submit" class="btn btn-secondary {{CSS.SUBMIT}}">{{get_string "addresource" component}}</button></div></form>'),e=this.get("host").canShowFilepicker("link"),i=a.Node.create(t({elementid:this.get("host").get("elementid"),CSS:l,FORMNAMES:o,component:n,showFilepicker:e,titleMaxLength:100}));return this._form=i,this._form.one(T.INPUTURL).on("change",this._manageUrlField,this),this._form.one(T.INPUTTITLE).on("change",this._manageTitleField,this),this._form.one(T.INPUTTITLE).on("input",this._onInputTitleCountChars,this),this._form.one(T.INPUTTITLE).on("propertychange",this._onInputTitleCountChars,this),this._form.one(T.SUBMIT).on("click",this._attachObject,this),e&&(this._form.one(T.FILEPICKER).on("click",function(){this.get("host").showFilepicker("link",this._filepickerCallback,this)},this),this._toggleLOFieldsVisibility(!1),a.on("domready",function(){this._form.one(T.FILEPICKER).simulate("click")},this)),i},_filepickerCallback:function(t){if(""!==t.url){const e={url:this._form.one(T.INPUTURL),title:this._form.one(T.INPUTTITLE)};e.url.set("value",t.url),e.title.set("value",t.file),this._onInputTitleCountChars(),this._toggleLOFieldsVisibility(!0)}},_sanitizeTextInput:function(t){return t.replace(/(<([^>]+)>)/gi,"")},_attachObject:async function(t){const e=this.get("host"),i=this._form,n={url:i.one(T.INPUTURL).get("value"),title:i.one(T.INPUTTITLE).get("value")};if(t.preventDefault(),!this._getWarnings()){if(e.focus(),""!==n.url){const l=a.Handlebars.compile('<iframe width="{{iriwidth}}" height="{{iriheight}}" srcdoc="{{irisrc}}" title="Inokufu\'s Learning Object" frameBorder="0"></iframe>'),s=await fetch(n.url);let e=await s.text();if(""!==n.title){n.title=this._sanitizeTextInput(n.title);try{let t;if("undefined"!=typeof DOMParser){const r=new DOMParser;t=r.parseFromString(e,"text/html")}else(t=new ActiveXObject("Microsoft.XMLDOM"))["async"]=!1,t.loadXML(e);t.getElementById("lo_title").innerHTML=n.title,e=t.documentElement.outerHTML}catch(t){alert("Please use a more recent browser to modify this title")}}var o=l({iriwidth:330,iriheight:340,irisrc:e});this.get("host").insertContentAtFocusPoint(o),this.markUpdated()}this.getDialogue({focusAfterHide:null}).hide()}},_toggleVisibility:function(t,e){const i=this._form,n=i.one(t);n.setStyle("display",e?"block":"none")},_toggleLOFieldsVisibility:function(t){for(const e of i)this._toggleVisibility(e,t)},_manageUrlField:function(){const t=this._form,e=t.one(T.INPUTURL).get("value");var i=""===e.trim();return this._toggleVisibility("."+l.RESOURCEURLWARNING,i),i},_manageTitleField:function(){const t=this._form,e=t.one(T.INPUTTITLE).get("value");var i=""===e.trim();return this._toggleVisibility("."+l.RESOURCETITLEWARNING,i),i},_getWarnings:function(){var t=this._manageUrlField(),e=this._manageTitleField(),t=t||e;return this.getDialogue().centerDialogue(),t},_onInputTitleCountChars:function(){const t=this._form;var e=t.one(T.INPUTTITLE).get("value");const i=t.one("."+l.INPUTTITLECOUNTERDIV),
n=t.one("."+l.INPUTTITLECOUNTER);n.setHTML(e.length),100<parseInt(n.get("innerHTML"))?(i.setStyle("color","red"),this._toggleVisibility("."+l.INPUTTITLECOUNTERWARNING,!0)):(i.setStyle("color","black"),this._toggleVisibility("."+l.INPUTTITLECOUNTERWARNING,!1))}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});